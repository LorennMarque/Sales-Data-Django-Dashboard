{% extends "layout.html" %}

{% block section %} 
<i data-feather="home"></i> Overview {%endblock%}
{% block content %}
            <div class="d-flex">
                <h4 data-aos="fade-zoom-in" >Historic Monthly Revenue</h4>
                <div class="ms-auto">
                    <button class="toggleButtons" onclick="toggleDataset('2015')">Ocultar 2015</button>
                    <button class="toggleButtons" onclick="toggleDataset('2016')">Ocultar 2016</button>
                    <button class="toggleButtons" onclick="toggleDataset('2017')">Ocultar 2017</button>
                    <button class="toggleButtons" onclick="toggleDataset('2018')">Ocultar 2018</button>
                </div>
            </div>
            <div class="card" style="height:400px" data-aos="fade-zoom-in" data-aos-delay="100">
                <canvas id="monthly_sales"></canvas>
            </div>
                <div class="row my-3">
                    <div class="col-lg-5">
                        <h4 data-aos="fade-zoom-in" >Overall Performance</h4>
                        <div class="row">
                            <div class="col-lg-6 ">
                                <div class="card px-3 justify-content-center" style="height:196px" data-aos="fade-zoom-in" data-aos-delay="100">
                                    <div style="height: 45px; width: 45px; background-color: #F7F8FC; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                        <i data-feather="dollar-sign" stroke="#212529"></i>
                                    </div>
                                    <p class="text-muted mt-2" style="font-size:12px;">Total Revenue</p>
                                    <h3>${{year_sales_total}}</h3>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card px-3 justify-content-center" style="height:196px" data-aos="fade-zoom-in" data-aos-delay="100">
                                    <div style="height: 45px; width: 45px; background-color: #F7F8FC; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                        <i data-feather="shopping-cart" stroke="#212529"></i>
                                    </div>
                                    <p class="text-muted mt-2" style="font-size:12px;">Sales Count</p>
                                    <h3 style="margin:0px;">{{year_sales_amount}} Sales</h3>
                                </div>
                            </div>
                            <div class="col-lg-6" style="margin-top:25px">
                                <div class="card px-3 justify-content-center" style="height:196px" data-aos="fade-zoom-in" data-aos-delay="200">
                                    <div style="height: 45px; width: 45px; background-color: #F7F8FC; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                        <i data-feather="clock" stroke="#212529"></i>
                                    </div>
                                    <p class="text-muted mt-2" style="font-size:12px;">Avg Time of Delivery</p>
                                    <h3>{{avg_delivery_time}} Hrs</h3>
                                </div>
                            </div>
                            <div class="col-lg-6" style="margin-top:25px">
                                <div class="card px-3 justify-content-center" style="height:196px" data-aos="fade-zoom-in" data-aos-delay="300">
                                    <div style="height: 45px; width: 45px; background-color: #F7F8FC; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                        <i data-feather="user" stroke="#212529"></i>
                                    </div>
                                    <p class="text-muted mt-2" style="font-size:12px;">Avg Revenue per Costumer</p>
                                    <h3>${{avg_income_per_costumer}}</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-7 mb-4">
                        <h4 data-aos="fade-zoom-in" data-aos-delay="150">Yearly Revenue</h4>
                        <div class="card p-3" style="height:420px" data-aos="fade-zoom-in" data-aos-delay="200">
                            {% comment %} {{sales_per_year}} {% endcomment %}

                            <canvas id="sales_per_year"></canvas>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-lg-5">
                        <h4 data-aos="fade-zoom-in" data-aos-delay="400">Revenue per State</h4>
                        <div class="card p-4" style="height:730px" data-aos="fade-zoom-in" data-aos-delay="450">
                            {% comment %} <h1>{{sales_amount_per_state}}</h1> {% endcomment %}
                            <canvas id="sales_amount_per_state"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-7">
                        <h4 data-aos="fade-zoom-in" data-aos-delay="500">All Products</h4>
                        <div class="card p-4" style="height:730px" data-aos="fade-zoom-in" data-aos-delay="550"> 
                            <table class="table table-striped mb-6">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Main Category</th>
                                        {% comment %} <th>Subcategory</th> {% endcomment %}
                                        <th>Sales</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for producto in best_selling_products %}
                                    <tr>
                                        <td>{{ producto.Product|truncatechars:50 }}</td>
                                        <td>{{ producto.MainCategory }}</td>
                                        {% comment %} <td>{{ producto.Subcategory }}</td> {% endcomment %}
                                        <td>{{ producto.Sales }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            <nav aria-label="Page navigation example">
                                <ul class="pagination">
                                    <li class="page-item"><a class="page-link" href="http://127.0.0.1:8000/?page={{pagination.first_page}}">First</a></li>
                                    {% for page in pagination.pages %}
                                    <li class="page-item"><a class="page-link {% if page == pagination.active_page %}active{% endif %}" href="http://127.0.0.1:8000/?page={{page}}">{{page}}</a></li>
                                    {% endfor %}
                                    <li class="page-item"><a class="page-link" href="http://127.0.0.1:8000/?page={{pagination.last_page}}">Last</a></li>
                                </ul>
                              </nav>
                              
                        </div>
                    </div>
                </div>

                {% comment %} ======================================================= {% endcomment %}
                {% endblock %}
{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var ctx = document.getElementById('sales_per_year').getContext('2d');
        var data = JSON.parse('{{ sales_per_year|escapejs }}'); // Ensure data is correctly escaped and parsed
    
        var years = data.map(function(item) {
            return item.year;
        });
    
        var sales = data.map(function(item) {
            return item.Sales;
        });
    
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: years,
                datasets: [{
                    label: 'Sales',
                    data: sales,
                    backgroundColor: '#8850F1',
                    borderColor: '#8850F1',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Revenue (USD)',
                            font: {
                                size: 16 // Ajusta el tamaño de la fuente para el título del eje Y
                            }
                        },
                        ticks: {
                            font: {
                                size: 14 // Ajusta el tamaño de la fuente para los labels en el eje Y
                            }
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Years',
                            font: {
                                size: 16 // Ajusta el tamaño de la fuente para el título del eje X
                            }
                        },
                        ticks: {
                            font: {
                                size: 14 // Ajusta el tamaño de la fuente para los labels en el eje X
                            }
                        }
                    }
                }
            }
        });
    });
</script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        var ctx = document.getElementById('sales_amount_per_state').getContext('2d');
        var data = JSON.parse('{{ sales_amount_per_state|escapejs }}'); // Ensure data is correctly escaped and parsed
        
        var state = data.map(function(item) {
            return item.State;
        });
    
        var sales = data.map(function(item) {
            return item.Sales;
        });
    
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: state,
                datasets: [{
                    label: 'Sales',
                    data: sales,
                    backgroundColor: '#8850F1',
                    borderColor: '#8850F1',
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            font: {
                                size: 14 // Ajusta el tamaño de la fuente para los labels en el eje Y
                            }
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Revenue (USD)',
                            font: {
                                size: 16 // Ajusta el tamaño de la fuente para el título del eje X
                            }
                        },
                        ticks: {
                            font: {
                                size: 14 // Ajusta el tamaño de la fuente para los labels en el eje X
                            }
                        }
                    }
                }
            }
        });
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var ctx = document.getElementById('monthly_sales').getContext('2d');
        var data_2015 = JSON.parse('{{ monthly_sales_2015|safe }}');
        var data_2016 = JSON.parse('{{ monthly_sales_2016|safe }}');
        var data_2017 = JSON.parse('{{ monthly_sales_2017|safe }}');
        var data_2018 = JSON.parse('{{ monthly_sales_2018|safe }}');

        var ship_mode_2015 = data_2015.map(function(item) {
            return item['month'];
        });
        var delivery_2015 = data_2015.map(function(item) {
            return item['Sales'];
        });

        var ship_mode_2016 = data_2016.map(function(item) {
            return item['month'];
        });
        var delivery_2016 = data_2016.map(function(item) {
            return item['Sales'];
        });

        var ship_mode_2017 = data_2017.map(function(item) {
            return item['month'];
        });
        var delivery_2017 = data_2017.map(function(item) {
            return item['Sales'];
        });

        var ship_mode_2018 = data_2018.map(function(item) {
            return item['month'];
        });
        var delivery_2018 = data_2018.map(function(item) {
            return item['Sales'];
        });

        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ship_mode_2015, // Utilizamos las etiquetas del conjunto de datos de 2015
                datasets: [{
                    label: '2015',
                    data: delivery_2015,
                    fill: false,
                    pointRadius: 5,
                    pointHoverRadius: 5,
                    borderColor: '#FF5733',
                    backgroundColor: '#FF5733'
                }, {
                    label: '2016',
                    data: delivery_2016,
                    fill: false,
                    pointRadius: 5,
                    pointHoverRadius: 5,
                    borderColor: '#8850F1',
                    backgroundColor: '#8850F1'
                }, {
                    label: '2017',
                    data: delivery_2017,
                    fill: false,
                    pointRadius: 5,
                    pointHoverRadius: 5,
                    borderColor: '#F15088',
                    backgroundColor: '#F15088'
                }, {
                    label: '2018',
                    data: delivery_2018,
                    fill: false,
                    pointRadius: 5,
                    pointHoverRadius: 5,
                    borderColor: '#50F188',
                    backgroundColor: '#50F188'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: 'Revenue',
                            font: {
                                size: 16 
                            }
                        },
                        ticks: {
                            font: {
                                size: 14 
                            }
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Months',
                            font: {
                                size: 16 
                            }
                        },
                        ticks: {
                            font: {
                                size: 14 
                            }
                        }
                    }
                }
            }
        });
    });
</script>
<script>
    function toggleDataset(year) {
        var chart = Chart.getChart('monthly_sales'); // Obtener la instancia del gráfico por su ID
        var datasetIndex = chart.data.datasets.findIndex(dataset => dataset.label === 'Avg delivery time - ' + year); // Encontrar el índice del conjunto de datos correspondiente al año

        if (datasetIndex !== -1) { // Si se encuentra el conjunto de datos
            var dataset = chart.getDatasetMeta(datasetIndex); // Obtener la metadata del conjunto de datos
            dataset.hidden = !dataset.hidden; // Cambiar el estado de ocultar/mostrar el conjunto de datos
            chart.update(); // Actualizar el gráfico
        }
    }
</script>


    {% endblock %}
